<header class="panel-heading">
  商品管理 / 添加商品
</button>
</header>
<div class="panel-body">
  <form class="form-horizontal" id="form"  role="form" enctype="multipart/form-data">
    <div class="form-group">
      <label class="col-sm-2 control-label">商品名称</label>
      <div class="col-sm-8">
        <input type="text" name="title" class="form-control"/>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">供应商</label>
      <div class="col-sm-8">
        <select name="supplierId"  class="form-control">
        </select>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">商品图片地址</label>
      <div class="col-sm-8">
        <input type="text" name="picUrl"   class="form-control"  value=""/>
        <input type="file" id="picUrl" name="file"  class="form-control"  value=""/>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">统一规格</label>
      <div class="col-sm-8">
        <input type="radio" name="uniformSpecs" checked value="1"/> 是
        &nbsp;
        <input type="radio" name="uniformSpecs"   value="0"/> 否
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">规格</label>
      <div class="col-sm-8 uniformSpecs_1">
        <input type="text" name="specs" class="form-control"  value=""/>
      </div>
      <div class="col-sm-8 uniformSpecs_0"  style="display: none">
         <table class="table table-hover table-bordered table-condensed">
           <thead>
            <tr>
              <td>
                <input type="text" name="specsName" class="form-control" placeholder="规格名称">
              </td>
              <td>
                <input type="number" name="specsOriginPrice" class="form-control" placeholder="进货价格(元)" min="0">
              </td>
              <td>
                <input type="number" name="specsPrice" class="form-control" placeholder="销售价格(元)" min="0">
              </td>
              <td>
                <input type="number" name="specsStock" class="form-control" placeholder="库存" min="0">
              </td>
              <td>
                <a href="javascript:addSpecs()">
                  <span class="glyphicon glyphicon-plus"></span>
                </a>
              </td>
            </tr>
           </thead>
           <tbody id="spescBody">
             <tr class="text-primary text-center">
               <th>规格</th>
               <th>进价(元)</th>
               <th>售价(元)</th>
               <th>库存</th>
               <th>操作</th>
             </tr>
           </tbody>
         </table>
      </div>
    </div>

    <div class="form-group uniformSpecs_1">
      <label class="col-sm-2 control-label">单位进价(元)</label>
      <div class="col-sm-8">
        <input type="number" name="originPrice" class="form-control" min="0" value="0"/>
      </div>
    </div>
    <div class="form-group uniformSpecs_1">
      <label class="col-sm-2 control-label">售价(元)</label>
      <div class="col-sm-8">
        <input type="number" name="price" class="form-control" min="0" value="0"/>
      </div>
    </div>
    <div class="form-group uniformSpecs_1">
      <label class="col-sm-2 control-label">库存</label>
      <div class="col-sm-8">
        <input type="number" name="stock" class="form-control" min="0" value="0"/>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">轮播图片</label>
      <div class="col-sm-8">
        <textarea name="topImages" class="form-control" rows="2"></textarea>
        <input type="file" name="file" multiple id="topImages" class="form-control" />
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">介绍图片</label>
      <div class="col-sm-8">
        <textarea name="tailImages" class="form-control" rows="2"></textarea>
        <input type="file" id="tailImages" multiple name="file" class="form-control" />
      </div>
    </div>

    <div class="form-group">
      <label class="col-sm-2 control-label"></label>
      <div class="col-sm-8">
        <button type="button" class="btn btn-primary" onclick="save()"><span
            class="glyphicon glyphicon-floppy-saved"></span>&nbsp;添加商品
        </button>
      </div>
    </div>
  </form>
</div>

<script>
  $(function () {
    $("input[name='uniformSpecs']").change(function () {
      var value = $(this).val();
      if(value == 1){
        $("div.uniformSpecs_1").show();
        $("div.uniformSpecs_0").hide();
      }else if(value == 0){
        $("div.uniformSpecs_1").hide();
        $("div.uniformSpecs_0").show();
      }
    });
    //查询供应商列表
    $.ajax({
      type:'get',
      dataType:'json',
      url:'/admin/supplier/getPageInfo',
      success:function(pageInfo){
        var list = pageInfo.dataList;
        $("select[name='supplierId']").html("");
        $.each(list, function(index, item){
          var option = $("<option value='"+item.id+"'>"+item.companyName+"</option>");
          $("select[name='supplierId']").append(option);
        })

      }

    });

    //初始化图片
    initFile("picUrl","images", null,"picUrl");
    initFile("topImages", "images/tops/",null, "topImages");
    initFile("tailImages", "images/tails/",null, "tailImages");

  });


  /**
   * 添加商品
   */
  function save() {
    var data = getParamsByFormId("form");
    var topImages = $("[name='topImages']").val().trim().split(",");
    var tailImages = $("[name='tailImages']").val().trim().split(",");
    data["topImages"] = topImages;
    data["tailImages"] = tailImages;

    //非统一规格，需要 添加规格列表
   var uniformSpecs = $("input:checked[name='uniformSpecs']").val();
   if(uniformSpecs == 0){
     var specsDtoList = [];
     data["specsDtoList"] = specsDtoList;
     var trs = $("tr.specs");
     $.each(trs, function(i, tr){
       var tds = $(tr).find("td");
       var name = tds.eq(0).html();
       var originPrice = tds.eq(1).html();
       var price = tds.eq(2).html();
       var stock = tds.eq(3).html();

       var spescObj = {};
       spescObj["name"] = name;
       spescObj["originPrice"] = originPrice;
       spescObj["price"] = price;
       spescObj["stock"] = stock;

       specsDtoList.push(spescObj);

     })

     console.log("specsDtoList------------")
     console.log(specsDtoList)
   }
    $.ajax({
      url:'/admin/goods/save',
      type:'post',
      dataType:'json',
      data:JSON.stringify(data) ,
      contentType:"application/json",
      success:function(res){
        if(res.code='0000'){
          var url="/goodsList";
          $("#mainDiv").load(url);
        }else{
          $.alert(res.msg);
        }
      }
    })
  }

  //添加规格
  function addSpecs(){
    var tbody = $("#spescBody");
    var specsName = $("input[name='specsName']").val().trim();//规格名称
    var specsOriginPrice = $("input[name='specsOriginPrice']").val();//进货价格
    var specsPrice = $("input[name='specsPrice']").val();//销售价格
    var specsStock = $("input[name='specsStock']").val();//库存
    if(!specsName){
      $.alert("规格名称不能为空");
      return ;
    }
    if(!specsOriginPrice){
      $.alert("进货价格不能为空");
      return ;
    }
    if(!specsPrice){
      $.alert("销售不能为空");
      return ;
    }
    if(!specsStock){
      $.alert("库存不能为空");
      return ;
    }
    var tr = $("<tr class='specs'></tr>");
    var td0 = $("<td>"+specsName+"</td>");
    var td1 = $("<td>"+specsOriginPrice+"</td>");
    var td2 = $("<td>"+specsPrice+"</td>");
    var td3 = $("<td>"+specsStock+"</td>");
    var aObj = $('<a href="javascript:void(0)" title="删除"><span class="glyphicon glyphicon-remove"></span></a>');
    var td4 = $("<td></td>").append(aObj);
    tr.append(td0).append(td1).append(td2).append(td3).append(td4);
    aObj.click(function () {
      $(this).parents("tr").remove();
    })
    tbody.append(tr);
  }
</script>
</body>
</html>