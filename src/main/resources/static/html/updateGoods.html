<header class="panel-heading">
  商品管理 / 编辑商品
</button>
</header>
<div class="panel-body">
  <form class="form-horizontal" id="form" role="form">
    <div class="form-group">
      <label class="col-sm-2 control-label">商品名称</label>
      <div class="col-sm-8">
        <input type="text" name="title" class="form-control"/>
        <input type="hidden" name="id"/>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">供应商</label>
      <div class="col-sm-8">
        <select name="supplierId"  class="form-control">
        </select>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">商品图片地址</label>
      <div class="col-sm-8">
        <input type="text" name="picUrl" class="form-control"  value=""/>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">缩略图地址</label>
      <div class="col-sm-8">
        <input type="text" name="minPicUrl" class="form-control"  value=""/>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">规格</label>
      <div class="col-sm-8">
        <input type="text" name="specs" class="form-control"  value=""/>
      </div>
    </div>

    <div class="form-group">
      <label class="col-sm-2 control-label">单位进价(元)</label>
      <div class="col-sm-8">
        <input type="number" id="originPrice" name="originPrice" class="form-control" min="0" value="0"/>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">售价(元)</label>
      <div class="col-sm-8">
        <input type="number" id="price" name="price" class="form-control" min="0" value="0"/>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">库存</label>
      <div class="col-sm-8">
        <input type="number" name="stock" class="form-control" min="0" value="0"/>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">状态</label>
      <div class="col-sm-8">
        <select name="status" class="form-control">
          <option value="1">销售中</option>
          <option value="0">已下架</option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">详情滚动图片</label>
      <div class="col-sm-8">
        <input type="text" id="topImages" class="form-control" />
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-2 control-label">详情介绍图片</label>
      <div class="col-sm-8">
        <input type="text" id="tailImages" class="form-control" />
      </div>
    </div>

    <div class="form-group">
      <label class="col-sm-2 control-label"></label>
      <div class="col-sm-8">
        <button type="button" class="btn btn-primary" onclick="save()"><span
            class="glyphicon glyphicon-floppy-saved"></span>&nbsp;编辑商品
        </button>
      </div>
    </div>
  </form>
</div>

<script>
  //查询供应商列表
  function getSupplier(data){
    $.ajax({
      type:'get',
      dataType:'json',
      url:'/admin/supplier/getPageInfo',
      success:function(pageInfo){
        var list = pageInfo.dataList;
        $("select[name='supplierId']").html("");
        $.each(list, function(index, item){
          var option = $("<option value='"+item.id+"'>"+item.companyName+"</option>");
          $("select[name='supplierId']").append(option);
        });

        $("select[name='supplierId']").val(data.supplierId);

        $("#origin")
      }

    });
  }
  //获取商品详情
  function getDetail() {
    var id = getQueryString("id");
    $.ajax({
      url:'/admin/goods/detail/'+id,
      type:'get',
      dataType:'json',
      success:function(res){
        var data = res.data;
        setDataByFormId("form", data);
        getSupplier(data);

       var topImages =  data.topImages;
       var tailImages =  data.tailImages;
       $("#topImages").val(topImages.join(","));
       $("#tailImages").val(tailImages.join(","))

       $("#originPrice").val(parseInt(data.originPrice)/100);
        $("#price").val(parseInt(data.price)/100);
      }
    })
  }

  $(function () {
    getDetail();
  });
  /**
   * 编辑商品
   */
  function save() {
    var data = getParamsByFormId("form");
    var topImages = $("#topImages").val().trim().split(",");
    var tailImages = $("#tailImages").val().trim().split(",");
    data["topImages"] = topImages;
    data["tailImages"] = tailImages;
    $.ajax({
      url:'/admin/goods/save',
      type:'post',
      dataType:'json',
      data:JSON.stringify(data) ,
      contentType:"application/json",
      success:function(res){
        if(res.code='0000'){
          var url="/goodsList";
          $("#mainDiv").load(url);
        }else{
          $.alert(res.msg);
        }
      }
    })
  }
</script>
</body>
</html>